variant: fcos
version: 1.0.0
passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBACq1GMxxOJIgn+XZc1gvkCBB3hBL0s1ewFaKOJJEaqm/WkYzSoZpGaQK0QuyF7wn0pMTVM7nU9aHXY/94TTcu4U+gAjTuIm1uJgAyUJY+WA/hoRMruYODeeghV8KcT+ttP7mHW8RlsJdjGlrNNBnKQ/FT7X1nxU5Lxv4/bEYujiyQcHkg==

systemd:
  units:
    - name: fcosdemo.service
      enabled: true
      contents: |
        [Unit]
        Description=A Webserver to use for a Fedora CoreOS Demo
        After=network-online.target
        Wants=network-online.target
        [Service]
        Type=forking
        KillMode=none
        Restart=on-failure
        RemainAfterExit=yes
        ExecStartPre=podman pull docker.io/benswinney/fcos-demo
        ExecStart=podman run -d --name fcos-demo-server -p 8080:8080 docker.io/benswinney/fcos-demo
        ExecStop=podman stop -t 10 fcos-demo-server
        ExecStopPost=podman rm fcos-demo-server
        [Install]
        WantedBy=multi-user.target